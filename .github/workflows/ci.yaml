name: CI

on:
  push:
    branches: [master]

jobs:
  # Compat:
  #   name: Compat
  #   runs-on: ubuntu-latest
  #   strategy:
  #     matrix:
  #       resolver:
  #         - lts-16
  #         - lts-14
  #         - lts-12
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2

  #     - name: Setup Haskell Stack
  #       uses: actions/setup-haskell@v1.1.2
  #       with:
  #         enable-stack: true
  #         stack-no-global: true
  #         stack-version: 'latest'

  #     - name: Cache Stack directory
  #       uses: actions/cache@v1
  #       with:
  #         path: ~/.stack
  #         key: stack-cache-Compat-${{ matrix.resolver }}

  #     - name: Build
  #       run: |
  #         stack build --resolver ${{ matrix.resolver }}

  # Linux:
  #   name: Linux
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2

  #     - name: Setup Haskell Stack
  #       uses: actions/setup-haskell@v1.1.2
  #       with:
  #         enable-stack: true
  #         stack-no-global: true
  #         stack-version: 'latest'

  #     - name: Cache Stack directory
  #       uses: actions/cache@v1
  #       with:
  #         path: ~/.stack
  #         key: stack-cache-Linux-2

  #     - name: Build
  #       run: |
  #         stack build --resolver nightly --ghc-options="-split-sections -O2"

  #     - name: Copy artifact
  #       run: |
  #         cp $(stack exec --resolver nightly which runhs) runhs

  #     - name: Compress artifact
  #       uses: svenstaro/upx-action@v2
  #       with:
  #         file: runhs

  #     - name: Upload artifact
  #       uses: actions/upload-artifact@v2
  #       with:
  #         name: Linux
  #         path: runhs

  # Mac:
  #   name: Mac
  #   runs-on: macOS-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2

  #     - name: Setup Haskell Stack
  #       uses: actions/setup-haskell@v1.1.2
  #       with:
  #         enable-stack: true
  #         stack-no-global: true
  #         stack-version: 'latest'

  #     - name: Cache Stack directory
  #       uses: actions/cache@v1
  #       with:
  #         path: ~/.stack
  #         key: stack-cache-Mac-2

  #     - name: Build
  #       run: |
  #         stack build --resolver nightly --ghc-options="-O2"

  #     - name: Copy artifact
  #       run: |
  #         cp $(stack exec --resolver nightly which runhs) runhs

  #     - name: Compress artifact
  #       uses: svenstaro/upx-action@v2
  #       with:
  #         file: runhs

  #     - name: Upload artifact
  #       uses: actions/upload-artifact@v2
  #       with:
  #         name: Mac
  #         path: runhs

  Windows:
    name: Windows
    runs-on: windows-latest
    steps:
      # - name: Checkout
      #   uses: actions/checkout@v2

      - name: Setup Haskell Stack
        uses: actions/setup-haskell@v1.1.2
        with:
          enable-stack: true
          stack-no-global: true
          stack-version: 'latest'

      - name: blah
        run: |
          stack path --stack-root
          echo (stack path --stack-root) > stack-root.txt

      - name: bloh
        uses: actions/upload-artifact@v2
        with:
          name: bleh
          path: stack-root.txt

      # - name: Cache Stack directory
      #   uses: actions/cache@v1
      #   with:
      #     path: C:\Users\runneradmin\AppData\Roaming\stack
      #     key: stack-cache-Windows-2

      # - name: Test cache
      #   run: |
      #     stack build --resolver nightly yaml

      # - name: Build
      #   run: |
      #     stack build --resolver nightly --ghc-options="-split-sections -O2"

      # - name: Copy artifact
      #   run: |
      #     copy (stack exec --resolver nightly where runhs) runhs.exe

      # - name: Compress artifact
      #   uses: svenstaro/upx-action@v2
      #   with:
      #     file: runhs.exe

      # - name: Upload artifact
      #   uses: actions/upload-artifact@v2
      #   with:
      #     name: Windows
      #     path: runhs.exe
